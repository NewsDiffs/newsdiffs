# http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/command-options-general.html
option_settings:
  aws:autoscaling:launchconfiguration:
    # TODO move to an env.-specific saved config
    InstanceType: t2.nano
    # TODO move to an env.-specific saved config
    SecurityGroups: newsdiffs-dev
  # Use this sg for the ELB instead of the autogenerated one
#  aws:elb:loadbalancer:
#    ManagedSecurityGroup: newsdiffs-dev
  # Use this sg for the ELB in addition to the autogenerated one
#  aws:elb:loadbalancer:
#    SecurityGroups: newsdiffs-dev
  aws:elasticbeanstalk:container:python:
    WSGIPath: website/wsgi.py
    # TODO move to an env.-specific saved config
    NumProcesses: 2
  aws:elasticbeanstalk:container:python:staticfiles:
    robots.txt: static/robots.txt
    favicon.ico: static/img/favicon.ico
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    RetentionInDays: 30

container_commands:
  01_django_syncdb:
    command: "python website/manage.py syncdb --noinput"
    leader_only: true
  02_django_migrate:
    command: "python website/manage.py migrate --noinput"
    leader_only: true
  04_ensure_articles_dir:
    command: "mkdir -p $ARTICLES_DIR_ROOT"
    leader_only: true
commands:
  20_ensure_log_file:
    command: "touch $LOG_FILE_PATH"
    test: "[ ! -e $LOG_FILE_PATH ]"
  # For some reason when this file is created for the first time the owner is root:root
  21_correct_log_file_owner:
    command: "chown wsgi:wsgi $LOG_FILE_PATH"